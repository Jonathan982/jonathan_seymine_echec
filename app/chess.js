'use strict';
/**
* Board
*/
class Board {
    constructor(boardSelector, statusSelector, startingPieces) {
        this.boardContainer = boardSelector.first();
        this.statusContainer = statusSelector.first();
        this.writeBoard();
        this.writePieces(startingPieces);
    }
    markActive(square) {
        this.removeActive();
        var active = 'active';
        var jqSquare = this.boardContainer.find(square.getSelector());
        jqSquare.addClass(active);
    }
    removeActive() {
        this.boardContainer.find('.chess-square').removeClass('active');
    }
    writePieces(pieces) {
        $('.chess-piece').remove();
        pieces.forEach((p) => {
            $('#' + p.placedAt.getName()).html(`<span id=${p.getId()}
            class='chess-piece chess-piece-${p.getColorName().toLocaleLowerCase()}'>
            ${p.symbol}
            </span>`);
        });
    }
    ;
    writeBoard() {
        let newBoardElement = this.boardContainer.html("<table id='chessTable'><thead id='chessHead'></thead></thead><tbody id='chessBody'></tbody><tfoot id='chessFoot'></tfoot></table>");
        let chessBody = $('#chessBody');
        this.squares = new Array();
        for (var i = 8; i >= 1; i--) {
            let rowString = "chessRow" + i;
            chessBody.append(`<tr id='${rowString}'></tr>`);
            for (var j = 1; j <= 8; j++) {
                let square = new Square(i, j);
                this.squares.push(square);
                $('#' + rowString).append(`<td id='${square.getName()}' data-row='${square.row}' data-col='${square.column}' class='chess-square chess-${this.colorClass(square)}'></td>`);
            }
        }
        return newBoardElement;
    }
    ;
    writeStatus(playedMoves, toMove) {
        var moveList = this.statusContainer.find('#moves').html('');
        ;
        playedMoves.forEach((move) => {
            moveList.append(`<li>${move.getNotation()}</li>`);
        });
        var colorClass = `chess-${this.colorClass(toMove)}`;
        this.statusContainer.find('#nextMove').removeClass().addClass(colorClass);
        return this.statusContainer;
    }
    ;
    colorClass(T) { return T.getColorName().toLowerCase(); }
}
class Chess {
    constructor(selector, statusSelector) {
        this.players = [new Player(Color.White), new Player(Color.Black)];
        this.toMove = this.players[Color.White];
        this.playedMoves = new Array();
        this.board = new Board(selector, statusSelector, this.getPieces());
        this.bindEvents(selector);
        this.selector = selector;
    }
    startMove(piece) {
        this.board.markActive(piece.placedAt);
        piece.selected = true;
        this.activeMove = new Move(piece.placedAt, piece);
    }
    ;
    endMove(piece, newSquare, piceToCapture) {
        if (!newSquare && !piece && this.activeMove == null)
            return false;
        this.activeMove.completeMove(newSquare, piceToCapture);
        this.playedMoves.push(this.activeMove);
        this.activeMove = null;
        this.board.removeActive();
        piece.placedAt = newSquare;
        piece.moved = true;
        piece.selected = false;
        var colorToMoveNext = this.toMove.color === Color.White ? Color.Black : Color.White;
        this.toMove = this.players[colorToMoveNext];
        return true;
    }
    ;
    getPieces() {
        let pieces = new Array().concat(this.players[Color.Black].pieces, this.players[Color.White].pieces);
        return pieces;
    }
    updateBoard() {
        this.board.writePieces(this.getPieces().filter((p) => !p.captured));
        this.board.writeStatus(this.playedMoves, this.toMove);
    }
    ;
    pieceClick(event) {
        var pieceId = event.target.id;
        var pieces = this.getPieces();
        var anySelected = this.anySelected(pieces);
        var piece = pieces.find((p) => p.getId() === pieceId);
        if (anySelected && this.toMove.color !== piece.color) {
            this.capturePiece(piece, pieces.find((p) => p.selected));
        }
        else if (this.toMove.color === piece.color) {
            pieces.forEach((p) => p.selected = false);
            this.startMove(piece);
        }
        this.updateBoard();
        return false;
    }
    ;
    squareClick(event) {
        if (event.currentTarget !== event.target)
            return false;
        var squareId = event.target.id;
        var pieces = this.getPieces();
        var anySelected = this.anySelected(pieces);
        var square = this.board.squares.find((s) => s.getName() == event.target.id);
        if (anySelected && this.activeMove) {
            var currentMove = this.activeMove;
            this.endMove(currentMove.piece, square, null);
        }
        this.updateBoard();
        return false;
    }
    bindEvents(selector) {
        selector.on('click', '.chess-piece', (eventObject) => {
            this.pieceClick(eventObject);
        });
        selector.on('click', '.chess-square', (eventObject) => {
            this.squareClick(eventObject);
        });
    }
    ;
    ;
    capturePiece(pieceToCapture, pieceToMove) {
        if (pieceToCapture.color === pieceToMove.color && this.playedMoves[this.playedMoves.length])
            return false;
        pieceToCapture.captured = true;
        this.endMove(pieceToMove, pieceToCapture.placedAt, pieceToCapture);
        return false;
    }
    ;
    anySelected(pieces) {
        return pieces.some((p) => p.selected);
    }
    getLastMove() {
        var length = this.playedMoves.length;
        if (length === 0)
            return null;
        return this.playedMoves[length - 1];
    }
    replaceLastMove(move) {
        this.playedMoves.pop();
        return this.playedMoves.push(move);
    }
}
class Move {
    constructor(start, piece) {
        this.isComplete = false;
        this.capture = null;
        this.piece = piece;
        this.start = start;
    }
    getNotation() {
        return this.piece.symbol + this.start.getName() + (this.capture ? 'x' + this.capture.symbol : '') + ' ' + this.end.getName();
    }
    completeMove(end, capture) {
        this.isComplete = true;
        this.capture = capture;
        this.end = end;
        return this;
    }
}
/**
 * Piece
 *
 */
class Piece {
    constructor(piceType, pieceColor, startAt, symbol) {
        this.type = piceType;
        this.color = pieceColor;
        this.placedAt = startAt;
        this.startAt = startAt;
        this.symbol = symbol;
        this.moved = false;
        this.captured = false;
        this.selected = false;
    }
    getId() {
        return this.startAt.getName() + this.symbol;
    }
    getColorName() {
        return Color[this.color];
    }
}
class King extends Piece {
    constructor(pieceColor, placedAt) {
        var symbol = pieceColor === Color.White ? '♔' : '♚';
        super(PieceType.King, pieceColor, placedAt, symbol);
    }
}
class Queen extends Piece {
    constructor(pieceColor, placedAt) {
        var symbol = pieceColor === Color.White ? '♕' : '♛';
        super(PieceType.Queen, pieceColor, placedAt, symbol);
    }
}
class Bishop extends Piece {
    constructor(pieceColor, placedAt) {
        var symbol = pieceColor === Color.White ? '♗' : '♝';
        super(PieceType.Bishop, pieceColor, placedAt, symbol);
    }
}
class Knight extends Piece {
    constructor(pieceColor, placedAt) {
        var symbol = pieceColor === Color.White ? '♘' : '♞';
        super(PieceType.Knight, pieceColor, placedAt, symbol);
    }
}
class Rook extends Piece {
    constructor(pieceColor, placedAt) {
        var symbol = pieceColor === Color.White ? '♖' : '♜';
        super(PieceType.Rook, pieceColor, placedAt, symbol);
    }
}
class Pawn extends Piece {
    constructor(pieceColor, placedAt) {
        var symbol = pieceColor === Color.White ? '♙' : '♟';
        super(PieceType.Pawn, pieceColor, placedAt, symbol);
    }
}
/**
 * Square
 */
class Square {
    constructor(row, column) {
        this.row = row;
        this.column = column;
    }
    getLetter() {
        return Columns[this.column];
    }
    ;
    getName() {
        return this.getLetter() + this.row;
    }
    getSelector() {
        return '#' + this.getName();
    }
    getColor() {
        return (this.row + this.column - 1) % 2;
    }
    getColorName() {
        return Color[this.getColor()];
    }
}
/**
 * Player
 */
class Player {
    constructor(color) {
        this.color = color;
        this.direction = color == Color.White ? MoveDirection.Up : MoveDirection.Down;
        let startingRow = this.isWhite() ? 1 : 8;
        this.pieces = new Array(new Rook(color, new Square(startingRow, Columns.A)), new Rook(color, new Square(startingRow, Columns.H)), new Knight(color, new Square(startingRow, Columns.G)), new Bishop(color, new Square(startingRow, Columns.C)), new Bishop(color, new Square(startingRow, Columns.F)), new Knight(color, new Square(startingRow, Columns.B)), new Queen(color, new Square(startingRow, Columns.D)), new King(color, new Square(startingRow, Columns.E))).concat(this.getStartingPawns());
    }
    isWhite() {
        return this.color === Color.White;
    }
    getColorName() {
        return Color[this.color];
    }
    getStartingPawns() {
        var pawns = new Array();
        for (var i = 1; i <= 8; i++) {
            pawns.push(new Pawn(this.color, new Square(this.isWhite() ? 2 : 7, i)));
        }
        return pawns;
    }
}
var PieceType;
(function (PieceType) {
    PieceType[PieceType["King"] = 1] = "King";
    PieceType[PieceType["Queen"] = 2] = "Queen";
    PieceType[PieceType["Rook"] = 3] = "Rook";
    PieceType[PieceType["Knight"] = 4] = "Knight";
    PieceType[PieceType["Bishop"] = 5] = "Bishop";
    PieceType[PieceType["Tower"] = 6] = "Tower";
    PieceType[PieceType["Pawn"] = 7] = "Pawn";
})(PieceType || (PieceType = {}));
var Color;
(function (Color) {
    Color[Color["White"] = 0] = "White";
    Color[Color["Black"] = 1] = "Black";
})(Color || (Color = {}));
var MoveDirection;
(function (MoveDirection) {
    MoveDirection[MoveDirection["Up"] = 1] = "Up";
    MoveDirection[MoveDirection["Down"] = -1] = "Down";
})(MoveDirection || (MoveDirection = {}));
var Columns;
(function (Columns) {
    Columns[Columns["A"] = 1] = "A";
    Columns[Columns["B"] = 2] = "B";
    Columns[Columns["C"] = 3] = "C";
    Columns[Columns["D"] = 4] = "D";
    Columns[Columns["E"] = 5] = "E";
    Columns[Columns["F"] = 6] = "F";
    Columns[Columns["G"] = 7] = "G";
    Columns[Columns["H"] = 8] = "H";
})(Columns || (Columns = {}));
$(function () {
    var chessGame = new Chess($("#board"), $("#status"));
});

//# sourceMappingURL=data:application/json;base64,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SyxDQUFDO0lBQ2pCLENBQUM7QUFDTCxDQUFDO0FBRUQsSUFBSyxTQUFnRTtBQUFyRSxXQUFLLFNBQVM7SUFBRyx5Q0FBUSxDQUFBO0lBQUUsMkNBQUssQ0FBQTtJQUFFLHlDQUFJLENBQUE7SUFBRSw2Q0FBTSxDQUFBO0lBQUUsNkNBQU0sQ0FBQTtJQUFFLDJDQUFLLENBQUE7SUFBRSx5Q0FBSSxDQUFBO0FBQUMsQ0FBQyxFQUFoRSxTQUFTLEtBQVQsU0FBUyxRQUF1RDtBQUNyRSxJQUFLLEtBQXNCO0FBQTNCLFdBQUssS0FBSztJQUFHLG1DQUFLLENBQUE7SUFBRSxtQ0FBSyxDQUFBO0FBQUMsQ0FBQyxFQUF0QixLQUFLLEtBQUwsS0FBSyxRQUFpQjtBQUMzQixJQUFLLGFBQW1DO0FBQXhDLFdBQUssYUFBYTtJQUFHLDZDQUFNLENBQUE7SUFBRSxrREFBUyxDQUFBO0FBQUMsQ0FBQyxFQUFuQyxhQUFhLEtBQWIsYUFBYSxRQUFzQjtBQUN4QyxJQUFLLE9BQXNDO0FBQTNDLFdBQUssT0FBTztJQUFHLCtCQUFLLENBQUE7SUFBRSwrQkFBQyxDQUFBO0lBQUUsK0JBQUMsQ0FBQTtJQUFFLCtCQUFDLENBQUE7SUFBRSwrQkFBQyxDQUFBO0lBQUUsK0JBQUMsQ0FBQTtJQUFFLCtCQUFDLENBQUE7SUFBRSwrQkFBQyxDQUFBO0FBQUMsQ0FBQyxFQUF0QyxPQUFPLEtBQVAsT0FBTyxRQUErQjtBQUczQyxDQUFDLENBQUM7SUFDRSxJQUFJLFNBQVMsR0FBRyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7QUFDekQsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoiY2hlc3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCdcclxuLyoqXHJcbiogQm9hcmRcclxuKi9cclxuY2xhc3MgQm9hcmQge1xyXG4gICAgc3F1YXJlczogU3F1YXJlW107XHJcbiAgICBib2FyZENvbnRhaW5lcjogSlF1ZXJ5O1xyXG4gICAgc3RhdHVzQ29udGFpbmVyOiBKUXVlcnk7XHJcblxyXG4gICAgbWFya0FjdGl2ZShzcXVhcmU6IFNxdWFyZSkge1xyXG4gICAgICAgIHRoaXMucmVtb3ZlQWN0aXZlKCk7XHJcbiAgICAgICAgdmFyIGFjdGl2ZSA9ICdhY3RpdmUnO1xyXG4gICAgICAgIHZhciBqcVNxdWFyZSA9IHRoaXMuYm9hcmRDb250YWluZXIuZmluZChzcXVhcmUuZ2V0U2VsZWN0b3IoKSk7XHJcbiAgICAgICAganFTcXVhcmUuYWRkQ2xhc3MoYWN0aXZlKTtcclxuICAgIH1cclxuXHJcbiAgICByZW1vdmVBY3RpdmUoKSB7XHJcbiAgICAgICAgdGhpcy5ib2FyZENvbnRhaW5lci5maW5kKCcuY2hlc3Mtc3F1YXJlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgfVxyXG5cclxuICAgIHdyaXRlUGllY2VzKHBpZWNlczogUGllY2VbXSk6IHZvaWQge1xyXG4gICAgICAgICQoJy5jaGVzcy1waWVjZScpLnJlbW92ZSgpO1xyXG4gICAgICAgIHBpZWNlcy5mb3JFYWNoKChwKSA9PiB7XHJcbiAgICAgICAgICAgICQoJyMnICsgcC5wbGFjZWRBdC5nZXROYW1lKCkpLmh0bWwoYDxzcGFuIGlkPSR7cC5nZXRJZCgpfVxyXG4gICAgICAgICAgICBjbGFzcz0nY2hlc3MtcGllY2UgY2hlc3MtcGllY2UtJHtwLmdldENvbG9yTmFtZSgpLnRvTG9jYWxlTG93ZXJDYXNlKCl9Jz5cclxuICAgICAgICAgICAgJHtwLnN5bWJvbH1cclxuICAgICAgICAgICAgPC9zcGFuPmApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICB3cml0ZUJvYXJkKCk6IEpRdWVyeSB7XHJcbiAgICAgICAgbGV0IG5ld0JvYXJkRWxlbWVudCA9IHRoaXMuYm9hcmRDb250YWluZXIuaHRtbChcIjx0YWJsZSBpZD0nY2hlc3NUYWJsZSc+PHRoZWFkIGlkPSdjaGVzc0hlYWQnPjwvdGhlYWQ+PC90aGVhZD48dGJvZHkgaWQ9J2NoZXNzQm9keSc+PC90Ym9keT48dGZvb3QgaWQ9J2NoZXNzRm9vdCc+PC90Zm9vdD48L3RhYmxlPlwiKTtcclxuICAgICAgICBsZXQgY2hlc3NCb2R5ID0gJCgnI2NoZXNzQm9keScpO1xyXG4gICAgICAgIHRoaXMuc3F1YXJlcyA9IG5ldyBBcnJheTxTcXVhcmU+KCk7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDg7IGkgPj0gMTsgaS0tKSB7XHJcbiAgICAgICAgICAgIGxldCByb3dTdHJpbmcgPSBcImNoZXNzUm93XCIgKyBpO1xyXG4gICAgICAgICAgICBjaGVzc0JvZHkuYXBwZW5kKGA8dHIgaWQ9JyR7cm93U3RyaW5nfSc+PC90cj5gKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDE7IGogPD0gODsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgc3F1YXJlID0gbmV3IFNxdWFyZShpLCBqKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3F1YXJlcy5wdXNoKHNxdWFyZSk7XHJcbiAgICAgICAgICAgICAgICAkKCcjJyArIHJvd1N0cmluZykuYXBwZW5kKGA8dGQgaWQ9JyR7c3F1YXJlLmdldE5hbWUoKX0nIGRhdGEtcm93PScke3NxdWFyZS5yb3d9JyBkYXRhLWNvbD0nJHtzcXVhcmUuY29sdW1ufScgY2xhc3M9J2NoZXNzLXNxdWFyZSBjaGVzcy0ke3RoaXMuY29sb3JDbGFzcyhzcXVhcmUpfSc+PC90ZD5gKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbmV3Qm9hcmRFbGVtZW50O1xyXG4gICAgfTtcclxuXHJcbiAgICB3cml0ZVN0YXR1cyhwbGF5ZWRNb3ZlczogTW92ZVtdLCB0b01vdmU6IFBsYXllcik6IEpRdWVyeSB7XHJcbiAgICAgICAgdmFyIG1vdmVMaXN0ID0gdGhpcy5zdGF0dXNDb250YWluZXIuZmluZCgnI21vdmVzJykuaHRtbCgnJyk7O1xyXG4gICAgICAgIHBsYXllZE1vdmVzLmZvckVhY2goKG1vdmUpID0+IHtcclxuICAgICAgICAgICAgbW92ZUxpc3QuYXBwZW5kKGA8bGk+JHttb3ZlLmdldE5vdGF0aW9uKCl9PC9saT5gKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdmFyIGNvbG9yQ2xhc3MgPSBgY2hlc3MtJHt0aGlzLmNvbG9yQ2xhc3ModG9Nb3ZlKX1gO1xyXG4gICAgICAgIHRoaXMuc3RhdHVzQ29udGFpbmVyLmZpbmQoJyNuZXh0TW92ZScpLnJlbW92ZUNsYXNzKCkuYWRkQ2xhc3MoY29sb3JDbGFzcyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdHVzQ29udGFpbmVyO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0cnVjdG9yKGJvYXJkU2VsZWN0b3I6IEpRdWVyeSwgc3RhdHVzU2VsZWN0b3I6IEpRdWVyeSwgc3RhcnRpbmdQaWVjZXM6IFBpZWNlW10pIHtcclxuICAgICAgICB0aGlzLmJvYXJkQ29udGFpbmVyID0gYm9hcmRTZWxlY3Rvci5maXJzdCgpO1xyXG4gICAgICAgIHRoaXMuc3RhdHVzQ29udGFpbmVyID0gc3RhdHVzU2VsZWN0b3IuZmlyc3QoKTtcclxuICAgICAgICB0aGlzLndyaXRlQm9hcmQoKTtcclxuICAgICAgICB0aGlzLndyaXRlUGllY2VzKHN0YXJ0aW5nUGllY2VzKTtcclxuICAgIH07XHJcblxyXG4gICAgcHJpdmF0ZSBjb2xvckNsYXNzPFQ+KFQ6IElIYXNDb2xvcik6IHN0cmluZyB7IHJldHVybiBULmdldENvbG9yTmFtZSgpLnRvTG93ZXJDYXNlKCk7IH1cclxufVxyXG5cclxuaW50ZXJmYWNlIElIYXNDb2xvciB7XHJcbiAgICBnZXRDb2xvck5hbWUoKTogc3RyaW5nO1xyXG59XHJcblxyXG5jbGFzcyBDaGVzcyB7XHJcbiAgICBib2FyZDogQm9hcmQ7XHJcbiAgICBwbGF5ZWRNb3ZlczogTW92ZVtdO1xyXG4gICAgYWN0aXZlTW92ZTogTW92ZTtcclxuICAgIHRvTW92ZTogUGxheWVyO1xyXG4gICAgcGxheWVyczogUGxheWVyW107XHJcbiAgICBzZWxlY3RvcjogSlF1ZXJ5O1xyXG5cclxuICAgIHN0YXJ0TW92ZShwaWVjZTogUGllY2UpIHtcclxuICAgICAgICB0aGlzLmJvYXJkLm1hcmtBY3RpdmUocGllY2UucGxhY2VkQXQpO1xyXG4gICAgICAgIHBpZWNlLnNlbGVjdGVkID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmFjdGl2ZU1vdmUgPSBuZXcgTW92ZShwaWVjZS5wbGFjZWRBdCwgcGllY2UpO1xyXG4gICAgfTtcclxuICAgIGVuZE1vdmUocGllY2U6IFBpZWNlLCBuZXdTcXVhcmU6IFNxdWFyZSwgcGljZVRvQ2FwdHVyZTogUGllY2UpOiBib29sZWFuIHtcclxuICAgICAgICBpZiAoIW5ld1NxdWFyZSAmJiAhcGllY2UgJiYgdGhpcy5hY3RpdmVNb3ZlID09IG51bGwpIHJldHVybiBmYWxzZTtcclxuICAgICAgICB0aGlzLmFjdGl2ZU1vdmUuY29tcGxldGVNb3ZlKG5ld1NxdWFyZSwgcGljZVRvQ2FwdHVyZSk7XHJcbiAgICAgICAgdGhpcy5wbGF5ZWRNb3Zlcy5wdXNoKHRoaXMuYWN0aXZlTW92ZSk7XHJcbiAgICAgICAgdGhpcy5hY3RpdmVNb3ZlID0gbnVsbDtcclxuICAgICAgICB0aGlzLmJvYXJkLnJlbW92ZUFjdGl2ZSgpO1xyXG4gICAgICAgIHBpZWNlLnBsYWNlZEF0ID0gbmV3U3F1YXJlO1xyXG4gICAgICAgIHBpZWNlLm1vdmVkID0gdHJ1ZTtcclxuICAgICAgICBwaWVjZS5zZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgIHZhciBjb2xvclRvTW92ZU5leHQgPSB0aGlzLnRvTW92ZS5jb2xvciA9PT0gQ29sb3IuV2hpdGUgPyBDb2xvci5CbGFjayA6IENvbG9yLldoaXRlO1xyXG4gICAgICAgIHRoaXMudG9Nb3ZlID0gdGhpcy5wbGF5ZXJzW2NvbG9yVG9Nb3ZlTmV4dF07XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9O1xyXG4gICAgZ2V0UGllY2VzKCk6IFBpZWNlW10ge1xyXG4gICAgICAgIGxldCBwaWVjZXMgPSBuZXcgQXJyYXk8UGllY2U+KCkuY29uY2F0KFxyXG4gICAgICAgICAgICB0aGlzLnBsYXllcnNbQ29sb3IuQmxhY2tdLnBpZWNlcyxcclxuICAgICAgICAgICAgdGhpcy5wbGF5ZXJzW0NvbG9yLldoaXRlXS5waWVjZXNcclxuICAgICAgICApO1xyXG4gICAgICAgIHJldHVybiBwaWVjZXM7XHJcbiAgICB9XHJcblxyXG4gICAgdXBkYXRlQm9hcmQoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5ib2FyZC53cml0ZVBpZWNlcyh0aGlzLmdldFBpZWNlcygpLmZpbHRlcigocCkgPT4gIXAuY2FwdHVyZWQpKTtcclxuICAgICAgICB0aGlzLmJvYXJkLndyaXRlU3RhdHVzKHRoaXMucGxheWVkTW92ZXMsIHRoaXMudG9Nb3ZlKTtcclxuICAgIH07XHJcblxyXG4gICAgcGllY2VDbGljayhldmVudDogSlF1ZXJ5RXZlbnRPYmplY3QpOiBib29sZWFuIHtcclxuICAgICAgICB2YXIgcGllY2VJZCA9IGV2ZW50LnRhcmdldC5pZDtcclxuICAgICAgICB2YXIgcGllY2VzID0gdGhpcy5nZXRQaWVjZXMoKTtcclxuICAgICAgICB2YXIgYW55U2VsZWN0ZWQgPSB0aGlzLmFueVNlbGVjdGVkKHBpZWNlcyk7XHJcblxyXG4gICAgICAgIHZhciBwaWVjZSA9IHBpZWNlcy5maW5kKChwKSA9PiBwLmdldElkKCkgPT09IHBpZWNlSWQpO1xyXG4gICAgICAgIGlmIChhbnlTZWxlY3RlZCAmJiB0aGlzLnRvTW92ZS5jb2xvciAhPT0gcGllY2UuY29sb3IpIHsvL2NhcHR1cmUgcGllY2UgXHJcbiAgICAgICAgICAgIHRoaXMuY2FwdHVyZVBpZWNlKHBpZWNlLCBwaWVjZXMuZmluZCgocCkgPT4gcC5zZWxlY3RlZCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh0aGlzLnRvTW92ZS5jb2xvciA9PT0gcGllY2UuY29sb3IpIHtcclxuICAgICAgICAgICAgcGllY2VzLmZvckVhY2goKHApID0+IHAuc2VsZWN0ZWQgPSBmYWxzZSk7XHJcbiAgICAgICAgICAgIHRoaXMuc3RhcnRNb3ZlKHBpZWNlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy51cGRhdGVCb2FyZCgpO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH07XHJcblxyXG4gICAgc3F1YXJlQ2xpY2soZXZlbnQ6IEpRdWVyeUV2ZW50T2JqZWN0KTogYm9vbGVhbiB7XHJcblxyXG4gICAgICAgIGlmIChldmVudC5jdXJyZW50VGFyZ2V0ICE9PSBldmVudC50YXJnZXQpIHJldHVybiBmYWxzZTtcclxuICAgICAgICB2YXIgc3F1YXJlSWQgPSBldmVudC50YXJnZXQuaWQ7XHJcbiAgICAgICAgdmFyIHBpZWNlcyA9IHRoaXMuZ2V0UGllY2VzKCk7XHJcbiAgICAgICAgdmFyIGFueVNlbGVjdGVkID0gdGhpcy5hbnlTZWxlY3RlZChwaWVjZXMpO1xyXG5cclxuICAgICAgICB2YXIgc3F1YXJlID0gdGhpcy5ib2FyZC5zcXVhcmVzLmZpbmQoKHMpID0+IHMuZ2V0TmFtZSgpID09IGV2ZW50LnRhcmdldC5pZClcclxuICAgICAgICBpZiAoYW55U2VsZWN0ZWQgJiYgdGhpcy5hY3RpdmVNb3ZlKSB7IC8vVG9kbzogVGhpcyB3aWxsIG5vdCB3b3JrIGZvciBlbiBwYXNzYW50IGFzIHlvdSBhcmUgbm90IGNsaWNraW5nIGEgcGllY2UuIFxyXG4gICAgICAgICAgICB2YXIgY3VycmVudE1vdmUgPSB0aGlzLmFjdGl2ZU1vdmU7XHJcbiAgICAgICAgICAgIHRoaXMuZW5kTW92ZShjdXJyZW50TW92ZS5waWVjZSwgc3F1YXJlLCBudWxsKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy51cGRhdGVCb2FyZCgpO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBiaW5kRXZlbnRzKHNlbGVjdG9yOiBKUXVlcnkpOiB2b2lkIHtcclxuICAgICAgICBzZWxlY3Rvci5vbignY2xpY2snLCAnLmNoZXNzLXBpZWNlJywgKGV2ZW50T2JqZWN0OiBKUXVlcnlFdmVudE9iamVjdCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnBpZWNlQ2xpY2soZXZlbnRPYmplY3QpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHNlbGVjdG9yLm9uKCdjbGljaycsICcuY2hlc3Mtc3F1YXJlJywgKGV2ZW50T2JqZWN0OiBKUXVlcnlFdmVudE9iamVjdCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNxdWFyZUNsaWNrKGV2ZW50T2JqZWN0KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBjb25zdHJ1Y3RvcihzZWxlY3RvcjogSlF1ZXJ5LCBzdGF0dXNTZWxlY3RvcjogSlF1ZXJ5KSB7XHJcblxyXG4gICAgICAgIHRoaXMucGxheWVycyA9IFtuZXcgUGxheWVyKENvbG9yLldoaXRlKSwgbmV3IFBsYXllcihDb2xvci5CbGFjayldO1xyXG4gICAgICAgIHRoaXMudG9Nb3ZlID0gdGhpcy5wbGF5ZXJzW0NvbG9yLldoaXRlXTtcclxuICAgICAgICB0aGlzLnBsYXllZE1vdmVzID0gbmV3IEFycmF5PE1vdmU+KCk7XHJcbiAgICAgICAgdGhpcy5ib2FyZCA9IG5ldyBCb2FyZChzZWxlY3Rvciwgc3RhdHVzU2VsZWN0b3IsIHRoaXMuZ2V0UGllY2VzKCkpO1xyXG4gICAgICAgIHRoaXMuYmluZEV2ZW50cyhzZWxlY3Rvcik7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RvciA9IHNlbGVjdG9yO1xyXG4gICAgfTtcclxuICAgIHByaXZhdGUgY2FwdHVyZVBpZWNlKHBpZWNlVG9DYXB0dXJlOiBQaWVjZSwgcGllY2VUb01vdmU6IFBpZWNlKTogYm9vbGVhbiB7XHJcbiAgICAgICAgaWYgKHBpZWNlVG9DYXB0dXJlLmNvbG9yID09PSBwaWVjZVRvTW92ZS5jb2xvciAmJiB0aGlzLnBsYXllZE1vdmVzW3RoaXMucGxheWVkTW92ZXMubGVuZ3RoXSlcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIHBpZWNlVG9DYXB0dXJlLmNhcHR1cmVkID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmVuZE1vdmUocGllY2VUb01vdmUsIHBpZWNlVG9DYXB0dXJlLnBsYWNlZEF0LCBwaWVjZVRvQ2FwdHVyZSk7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfTtcclxuICAgIHByaXZhdGUgYW55U2VsZWN0ZWQocGllY2VzOiBQaWVjZVtdKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuIHBpZWNlcy5zb21lKChwKSA9PiBwLnNlbGVjdGVkKTtcclxuICAgIH1cclxuICAgIHByaXZhdGUgZ2V0TGFzdE1vdmUoKTogTW92ZSB7XHJcbiAgICAgICAgdmFyIGxlbmd0aCA9IHRoaXMucGxheWVkTW92ZXMubGVuZ3RoO1xyXG4gICAgICAgIGlmIChsZW5ndGggPT09IDApIHJldHVybiBudWxsO1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBsYXllZE1vdmVzW2xlbmd0aCAtIDFdO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVwbGFjZUxhc3RNb3ZlKG1vdmU6IE1vdmUpOiBudW1iZXIge1xyXG4gICAgICAgIHRoaXMucGxheWVkTW92ZXMucG9wKCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGxheWVkTW92ZXMucHVzaChtb3ZlKTtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgTW92ZSB7XHJcbiAgICBzdGFydDogU3F1YXJlO1xyXG4gICAgZW5kOiBTcXVhcmU7XHJcbiAgICBwaWVjZTogUGllY2U7XHJcbiAgICBjYXB0dXJlOiBQaWVjZTtcclxuICAgIGlzQ29tcGxldGU6IGJvb2xlYW47XHJcblxyXG4gICAgZ2V0Tm90YXRpb24oKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5waWVjZS5zeW1ib2wgKyB0aGlzLnN0YXJ0LmdldE5hbWUoKSArICh0aGlzLmNhcHR1cmUgPyAneCcgKyB0aGlzLmNhcHR1cmUuc3ltYm9sIDogJycpICsgJyAnICsgdGhpcy5lbmQuZ2V0TmFtZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbXBsZXRlTW92ZShlbmQ6IFNxdWFyZSwgY2FwdHVyZTogUGllY2UpOiBNb3ZlIHtcclxuICAgICAgICB0aGlzLmlzQ29tcGxldGUgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuY2FwdHVyZSA9IGNhcHR1cmU7XHJcbiAgICAgICAgdGhpcy5lbmQgPSBlbmQ7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3RydWN0b3Ioc3RhcnQ6IFNxdWFyZSwgcGllY2U6IFBpZWNlKSB7XHJcbiAgICAgICAgdGhpcy5pc0NvbXBsZXRlID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5jYXB0dXJlID0gbnVsbDtcclxuICAgICAgICB0aGlzLnBpZWNlID0gcGllY2U7XHJcbiAgICAgICAgdGhpcy5zdGFydCA9IHN0YXJ0O1xyXG4gICAgfVxyXG5cclxufVxyXG5cclxuLyoqXHJcbiAqIFBpZWNlXHJcbiAqXHJcbiAqL1xyXG5jbGFzcyBQaWVjZSBpbXBsZW1lbnRzIElIYXNDb2xvciB7XHJcblxyXG4gICAgY29sb3I6IENvbG9yO1xyXG4gICAgcGxhY2VkQXQ6IFNxdWFyZTtcclxuICAgIHN0YXJ0QXQ6IFNxdWFyZTtcclxuICAgIHR5cGU6IFBpZWNlVHlwZTtcclxuICAgIG1vdmVkOiBib29sZWFuO1xyXG4gICAgY2FwdHVyZWQ6IGJvb2xlYW47XHJcbiAgICBzZWxlY3RlZDogYm9vbGVhbjtcclxuICAgIHN5bWJvbDogc3RyaW5nO1xyXG5cclxuICAgIGdldElkKCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhcnRBdC5nZXROYW1lKCkgKyB0aGlzLnN5bWJvbDtcclxuICAgIH1cclxuXHJcbiAgICBnZXRDb2xvck5hbWUoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gQ29sb3JbdGhpcy5jb2xvcl07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcGljZVR5cGU6IFBpZWNlVHlwZSxcclxuICAgICAgICBwaWVjZUNvbG9yOiBDb2xvcixcclxuICAgICAgICBzdGFydEF0OiBTcXVhcmUsXHJcbiAgICAgICAgc3ltYm9sOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLnR5cGUgPSBwaWNlVHlwZTtcclxuICAgICAgICB0aGlzLmNvbG9yID0gcGllY2VDb2xvcjtcclxuICAgICAgICB0aGlzLnBsYWNlZEF0ID0gc3RhcnRBdDtcclxuICAgICAgICB0aGlzLnN0YXJ0QXQgPSBzdGFydEF0O1xyXG4gICAgICAgIHRoaXMuc3ltYm9sID0gc3ltYm9sO1xyXG4gICAgICAgIHRoaXMubW92ZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmNhcHR1cmVkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBLaW5nIGV4dGVuZHMgUGllY2Uge1xyXG4gICAgY29uc3RydWN0b3IocGllY2VDb2xvcjogQ29sb3IsIHBsYWNlZEF0OiBTcXVhcmUpIHtcclxuICAgICAgICB2YXIgc3ltYm9sID0gcGllY2VDb2xvciA9PT0gQ29sb3IuV2hpdGUgPyAn4pmUJyA6ICfimZonO1xyXG4gICAgICAgIHN1cGVyKFBpZWNlVHlwZS5LaW5nLCBwaWVjZUNvbG9yLCBwbGFjZWRBdCwgc3ltYm9sKTtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgUXVlZW4gZXh0ZW5kcyBQaWVjZSB7XHJcbiAgICBjb25zdHJ1Y3RvcihwaWVjZUNvbG9yOiBDb2xvciwgcGxhY2VkQXQ6IFNxdWFyZSkge1xyXG4gICAgICAgIHZhciBzeW1ib2wgPSBwaWVjZUNvbG9yID09PSBDb2xvci5XaGl0ZSA/ICfimZUnIDogJ+KZmyc7XHJcbiAgICAgICAgc3VwZXIoUGllY2VUeXBlLlF1ZWVuLCBwaWVjZUNvbG9yLCBwbGFjZWRBdCwgc3ltYm9sKTtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgQmlzaG9wIGV4dGVuZHMgUGllY2Uge1xyXG4gICAgY29uc3RydWN0b3IocGllY2VDb2xvcjogQ29sb3IsIHBsYWNlZEF0OiBTcXVhcmUpIHtcclxuICAgICAgICB2YXIgc3ltYm9sID0gcGllY2VDb2xvciA9PT0gQ29sb3IuV2hpdGUgPyAn4pmXJyA6ICfimZ0nO1xyXG4gICAgICAgIHN1cGVyKFBpZWNlVHlwZS5CaXNob3AsIHBpZWNlQ29sb3IsIHBsYWNlZEF0LCBzeW1ib2wpO1xyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBLbmlnaHQgZXh0ZW5kcyBQaWVjZSB7XHJcbiAgICBjb25zdHJ1Y3RvcihwaWVjZUNvbG9yOiBDb2xvciwgcGxhY2VkQXQ6IFNxdWFyZSkge1xyXG4gICAgICAgIHZhciBzeW1ib2wgPSBwaWVjZUNvbG9yID09PSBDb2xvci5XaGl0ZSA/ICfimZgnIDogJ+KZnic7XHJcbiAgICAgICAgc3VwZXIoUGllY2VUeXBlLktuaWdodCwgcGllY2VDb2xvciwgcGxhY2VkQXQsIHN5bWJvbCk7XHJcblxyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBSb29rIGV4dGVuZHMgUGllY2Uge1xyXG4gICAgY29uc3RydWN0b3IocGllY2VDb2xvcjogQ29sb3IsIHBsYWNlZEF0OiBTcXVhcmUpIHtcclxuICAgICAgICB2YXIgc3ltYm9sID0gcGllY2VDb2xvciA9PT0gQ29sb3IuV2hpdGUgPyAn4pmWJyA6ICfimZwnO1xyXG4gICAgICAgIHN1cGVyKFBpZWNlVHlwZS5Sb29rLCBwaWVjZUNvbG9yLCBwbGFjZWRBdCwgc3ltYm9sKTtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgUGF3biBleHRlbmRzIFBpZWNlIHtcclxuICAgIGNvbnN0cnVjdG9yKHBpZWNlQ29sb3I6IENvbG9yLCBwbGFjZWRBdDogU3F1YXJlKSB7XHJcbiAgICAgICAgdmFyIHN5bWJvbCA9IHBpZWNlQ29sb3IgPT09IENvbG9yLldoaXRlID8gJ+KZmScgOiAn4pmfJztcclxuICAgICAgICBzdXBlcihQaWVjZVR5cGUuUGF3biwgcGllY2VDb2xvciwgcGxhY2VkQXQsIHN5bWJvbCk7XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG5cclxuLyoqXHJcbiAqIFNxdWFyZVxyXG4gKi9cclxuY2xhc3MgU3F1YXJlIGltcGxlbWVudHMgSUhhc0NvbG9yIHtcclxuICAgIHJvdzogbnVtYmVyO1xyXG4gICAgY29sdW1uOiBDb2x1bW5zO1xyXG5cclxuICAgIGdldExldHRlcigpIHtcclxuICAgICAgICByZXR1cm4gQ29sdW1uc1t0aGlzLmNvbHVtbl07XHJcbiAgICB9O1xyXG5cclxuICAgIGdldE5hbWUoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRMZXR0ZXIoKSArIHRoaXMucm93O1xyXG4gICAgfVxyXG5cclxuICAgIGdldFNlbGVjdG9yKCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuICcjJyArIHRoaXMuZ2V0TmFtZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldENvbG9yKCkge1xyXG4gICAgICAgIHJldHVybiAodGhpcy5yb3cgKyB0aGlzLmNvbHVtbiAtIDEpICUgMlxyXG4gICAgfVxyXG5cclxuICAgIGdldENvbG9yTmFtZSgpIHtcclxuICAgICAgICByZXR1cm4gQ29sb3JbdGhpcy5nZXRDb2xvcigpXTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihyb3c6IG51bWJlciwgY29sdW1uOiBDb2x1bW5zKSB7XHJcbiAgICAgICAgdGhpcy5yb3cgPSByb3c7XHJcbiAgICAgICAgdGhpcy5jb2x1bW4gPSBjb2x1bW47XHJcbiAgICB9XHJcblxyXG59XHJcblxyXG5cclxuLyoqXHJcbiAqIFBsYXllclxyXG4gKi9cclxuY2xhc3MgUGxheWVyIGltcGxlbWVudHMgSUhhc0NvbG9yIHtcclxuICAgIGNvbG9yOiBDb2xvcjtcclxuICAgIGRpcmVjdGlvbjogTW92ZURpcmVjdGlvbjtcclxuICAgIHBpZWNlczogUGllY2VbXTtcclxuXHJcbiAgICBpc1doaXRlKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNvbG9yID09PSBDb2xvci5XaGl0ZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRDb2xvck5hbWUoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gQ29sb3JbdGhpcy5jb2xvcl07XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3RydWN0b3IoY29sb3I6IENvbG9yKSB7XHJcbiAgICAgICAgdGhpcy5jb2xvciA9IGNvbG9yO1xyXG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gY29sb3IgPT0gQ29sb3IuV2hpdGUgPyBNb3ZlRGlyZWN0aW9uLlVwIDogTW92ZURpcmVjdGlvbi5Eb3duO1xyXG4gICAgICAgIGxldCBzdGFydGluZ1JvdyA9IHRoaXMuaXNXaGl0ZSgpID8gMSA6IDg7XHJcbiAgICAgICAgdGhpcy5waWVjZXMgPSBuZXcgQXJyYXk8UGllY2U+KFxyXG4gICAgICAgICAgICBuZXcgUm9vayhjb2xvciwgbmV3IFNxdWFyZShzdGFydGluZ1JvdywgQ29sdW1ucy5BKSksXHJcbiAgICAgICAgICAgIG5ldyBSb29rKGNvbG9yLCBuZXcgU3F1YXJlKHN0YXJ0aW5nUm93LCBDb2x1bW5zLkgpKSxcclxuICAgICAgICAgICAgbmV3IEtuaWdodChjb2xvciwgbmV3IFNxdWFyZShzdGFydGluZ1JvdywgQ29sdW1ucy5HKSksXHJcbiAgICAgICAgICAgIG5ldyBCaXNob3AoY29sb3IsIG5ldyBTcXVhcmUoc3RhcnRpbmdSb3csIENvbHVtbnMuQykpLFxyXG4gICAgICAgICAgICBuZXcgQmlzaG9wKGNvbG9yLCBuZXcgU3F1YXJlKHN0YXJ0aW5nUm93LCBDb2x1bW5zLkYpKSxcclxuICAgICAgICAgICAgbmV3IEtuaWdodChjb2xvciwgbmV3IFNxdWFyZShzdGFydGluZ1JvdywgQ29sdW1ucy5CKSksXHJcbiAgICAgICAgICAgIG5ldyBRdWVlbihjb2xvciwgbmV3IFNxdWFyZShzdGFydGluZ1JvdywgQ29sdW1ucy5EKSksXHJcbiAgICAgICAgICAgIG5ldyBLaW5nKGNvbG9yLCBuZXcgU3F1YXJlKHN0YXJ0aW5nUm93LCBDb2x1bW5zLkUpKVxyXG4gICAgICAgICkuY29uY2F0KHRoaXMuZ2V0U3RhcnRpbmdQYXducygpKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldFN0YXJ0aW5nUGF3bnMoKTogUGF3bltdIHtcclxuICAgICAgICB2YXIgcGF3bnMgPSBuZXcgQXJyYXk8UGF3bj4oKTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8PSA4OyBpKyspIHtcclxuICAgICAgICAgICAgcGF3bnMucHVzaChuZXcgUGF3bih0aGlzLmNvbG9yLCBuZXcgU3F1YXJlKHRoaXMuaXNXaGl0ZSgpID8gMiA6IDcsIGkpKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBwYXducztcclxuICAgIH1cclxufVxyXG5cclxuZW51bSBQaWVjZVR5cGUgeyBLaW5nID0gMSwgUXVlZW4sIFJvb2ssIEtuaWdodCwgQmlzaG9wLCBUb3dlciwgUGF3biB9XHJcbmVudW0gQ29sb3IgeyBXaGl0ZSwgQmxhY2sgfVxyXG5lbnVtIE1vdmVEaXJlY3Rpb24geyBVcCA9IDEsIERvd24gPSAtMSB9XHJcbmVudW0gQ29sdW1ucyB7IEEgPSAxLCBCLCBDLCBELCBFLCBGLCBHLCBIIH1cclxuXHJcblxyXG4kKGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIGNoZXNzR2FtZSA9IG5ldyBDaGVzcygkKFwiI2JvYXJkXCIpLCAkKFwiI3N0YXR1c1wiKSk7XHJcbn0pO1xyXG5cclxuXHJcblxyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
